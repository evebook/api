version: '3'

services:

    postgres:
        image: postgres:latest

    redis:
        image: redis:latest

    evebook-nest-common:
        build: .
        image: evebook/nest-common
        entrypoint: echo "Image-only service is not intended to be run, exiting."

    api:
        command: yarn run start
        image: evebook/nest-common
        env_file:
          - .env
        ports:
          - "3000:3000"
        volumes:
          - .:/app/src
          - /app/src/node_modules
        links:
          - postgres
          - redis
        depends_on:
          - postgres
          - redis

    updater:
        command: yarn run start:updater
        image: evebook/nest-common
        env_file:
          - .env
        ports:
          - "3001:3001"
        volumes:
          - .:/app/src
          - /app/src/node_modules
        links:
          - postgres
          - redis
        depends_on:
          - postgres
          - redis

    killmails:
        command: yarn run start:killmails
        image: evebook/nest-common
        env_file:
          - .env
        ports:
          - "3002:3002"
        volumes:
          - .:/app/src
          - /app/src/node_modules
        links:
          - postgres
          - redis
        depends_on:
          - postgres
          - redis